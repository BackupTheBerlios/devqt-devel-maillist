From fullmetalcoder at hotmail.fr  Mon May  1 17:25:03 2006
From: fullmetalcoder at hotmail.fr (henry badinter)
Date: Mon, 01 May 2006 17:25:03 +0200
Subject: [Devqt-devel] RE : new branch alpha 3
Message-ID: <BAY114-F20A05BF1991B7CA319D543A7B10@phx.gbl>

hi,

Elcuco, didn't I tell you that I would be away for a few days??? I'm back 
now and I've read all the messages : very interesting.

I intentionnally removed version information because the name of the lib 
became ugly but if you absolutely want to put it back it doesn't matter.

The project stuff to move the shared lib into executable dir are nice but 
how could we link the app and default plugin against it???

Why is that stripping needed? BTW what is stripping?
How to avoid using a script to set library path? Are we forced to put bins 
into a build dir?

Another archive is coming soon, I'm now focusing on the defaut plugin, 
especially the project management and file loading stuff but I've also done 
some minor change int the core dll.

_________________________________________________________________
Retrouvez tout en un clin d'oeil avec la barre d'outil MSN Search ! 
http://desktop.msn.fr/



From elcuco at berlios.de  Fri May  5 14:19:47 2006
From: elcuco at berlios.de (elcuco at berlios.de)
Date: Fri, 5 May 2006 14:19:47 +0200
Subject: [Devqt-devel] r79 - in tools/qmdilib/demos/plugin-demo: . plugins/editor plugins/help
Message-ID: <200605051219.k45CJlIe018860@sheep.berlios.de>

Author: elcuco
Date: 2006-05-05 14:19:05 +0200 (Fri, 05 May 2006)
New Revision: 79

Modified:
   tools/qmdilib/demos/plugin-demo/configdialog.cpp
   tools/qmdilib/demos/plugin-demo/configdialog.h
   tools/qmdilib/demos/plugin-demo/iplugin.cpp
   tools/qmdilib/demos/plugin-demo/iplugin.h
   tools/qmdilib/demos/plugin-demo/mainwindow3.cpp
   tools/qmdilib/demos/plugin-demo/mainwindow3.h
   tools/qmdilib/demos/plugin-demo/plugin-demo.pro
   tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp
   tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h
   tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui
   tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp
   tools/qmdilib/demos/plugin-demo/plugins/help/help.h
   tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui
   tools/qmdilib/demos/plugin-demo/pluningmanager.cpp
   tools/qmdilib/demos/plugin-demo/pluningmanager.h
Log:
This is a large commit, sorry for this :)

 - The plugin manager will try to close client
   with the defined interfaces. This means that you
   will be asekd to save your work if needed after
   you click the close command.
 - Remade the configuration dialog layout, now looks better IMHO,
   as one whole dialog and not as 3 widgets separated.
 - Various fixes on the configuration dialog as well.
 - Each IPlugin as an icon. A sane default is provided.
 - The plugins now can set the data to the dialog and get it
   on demand. When the user presses "Apply" all the enabled pluings
   will call "getData()" and on close (yes, on close) the function
   "setData()", which will overite the previous settings (the
   Close button on the dialog is treaed as cancel). 
   On real life implementations, plugins should emit a signal on the
   setData function, to announce all the mdi clients generated by it,
   that they should update the display (all text editor should modify 
   their font).
 - The help browser has the ability to run external browsers when
   a non supported link has been clicked. On many pages of the Qt 
   help we can find links to "http://...." which are not supported by 
   QTextBrowser. Users should visit this with a proper browser for this 
   anyway. Currently no configuration has been made, and it defauts to
   an empty browser, which means this functionality is disabled.
 - Added a mainpage.dox stub. I need to start thinking about betetr documentation.
   


Modified: tools/qmdilib/demos/plugin-demo/configdialog.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/configdialog.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/configdialog.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,62 +1,56 @@
-/****************************************************************************
-**
-** Copyright (C) 2005-2006 Trolltech AS. All rights reserved.
-**
-** This file is part of the example classes of the Qt Toolkit.
-**
-** This file may be used under the terms of the GNU General Public
-** License version 2.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of
-** this file.  Please review the following information to ensure GNU
-** General Public Licensing requirements will be met:
-** http://www.trolltech.com/products/qt/opensource.html
-**
-** If you are unsure which license is appropriate for your use, please
-** review the following information:
-** http://www.trolltech.com/products/qt/licensing.html or contact the
-** sales department at sales at trolltech.com.
-**
-** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
-** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
-**
-****************************************************************************/
-
 #include <QtGui>
 #include <QIcon>
+#include <QLabel>
 
 #include "configdialog.h"
-// #include "pages.h"
 
 ConfigDialog::ConfigDialog()
 {
+	setSizeGripEnabled(true);
+	
 	contentsWidget = new QListWidget;
 	contentsWidget->setViewMode(QListView::IconMode);
 	contentsWidget->setIconSize(QSize(96, 84));
 	contentsWidget->setMovement(QListView::Static);
 	contentsWidget->setMaximumWidth(128);
-// 	contentsWidget->setSpacing(12);
-// 	contentsWidget->setModelColumn( 0 );
+	contentsWidget->setSpacing( 0 );
+	contentsWidget->setModelColumn( 0 );
 	contentsWidget->setFlow( QListView::TopToBottom );
+	
+	pagesWidget = new QStackedWidget(this);
+	applyButton = new QPushButton(tr("&Apply"));
+	closeButton = new QPushButton(tr("&Close"));
 
+	QHBoxLayout *mainLayout		= new QHBoxLayout(this);
+	QVBoxLayout *vLayout		= new QVBoxLayout;
+	QHBoxLayout *buttonsLayout	= new QHBoxLayout;
+
+	vLayout->setObjectName("vLayout");
+	buttonsLayout->setObjectName("buttonsLayout");
+	mainLayout->setObjectName("mainLayout");
 	
-	pagesWidget = new QStackedWidget;
-	QPushButton *closeButton = new QPushButton(tr("Close"));
+// 	QFrame *line1 = new QFrame;
+	QFrame *line2 = new QFrame;
+// 	currentPageLabel = new QLabel;
 	
-	QHBoxLayout *horizontalLayout = new QHBoxLayout;
-	horizontalLayout->addWidget(contentsWidget);
-	horizontalLayout->addWidget(pagesWidget, 1);
+// 	line1->setFrameShape(QFrame::HLine);
+	line2->setFrameShape(QFrame::HLine);
 	
-	QHBoxLayout *buttonsLayout = new QHBoxLayout;
 	buttonsLayout->addStretch(1);
+	buttonsLayout->addWidget(applyButton);
 	buttonsLayout->addWidget(closeButton);
+
+// 	vLayout->addWidget( currentPageLabel );
+// 	vLayout->addWidget( line1 );
+	vLayout->addWidget( pagesWidget );
+	vLayout->addWidget( line2 );
+	vLayout->addLayout( buttonsLayout );
 	
-	QVBoxLayout *mainLayout = new QVBoxLayout;
-	mainLayout->addLayout(horizontalLayout);
-	mainLayout->addStretch(1);
-	mainLayout->addSpacing(12);
-	mainLayout->addLayout(buttonsLayout);
+	mainLayout->addWidget(contentsWidget);
+	mainLayout->addLayout(vLayout);
 	setLayout(mainLayout);
 	
+	connect(applyButton, SIGNAL(clicked()), this, SLOT(applyChanges()));
 	connect(closeButton, SIGNAL(clicked()), this, SLOT(close()));
 	connect(contentsWidget,
 		SIGNAL(currentItemChanged(QListWidgetItem *, QListWidgetItem *)),
@@ -65,12 +59,26 @@
 	setWindowTitle(tr("Config Dialog"));
 }
 
+ConfigDialog::~ConfigDialog()
+{
+	contentsWidget->clear();
+
+	// objects are not deleted by the GUI, but the plugins
+	// without this code, glibc will complain about deleting the same 
+	// object twise: the dangling pointer problem
+	for( int i=pagesWidget->count(); i!=0; i--)
+		pagesWidget->removeWidget( pagesWidget->currentWidget() );
+}
+
 void ConfigDialog::changePage(QListWidgetItem *current, QListWidgetItem *previous)
 {
 	if (!current)
         	current = previous;
 
-	pagesWidget->setCurrentIndex(contentsWidget->row(current));
+	int newRow = contentsWidget->row(current);
+	pagesWidget->setCurrentIndex( newRow );
+// 	QListWidgetItem *w = contentsWidget->item(newRow);
+// 	currentPageLabel->setText( w->text() );
 }
 
 void ConfigDialog::addPage( QWidget *w, QIcon i )
@@ -81,7 +89,23 @@
 	item->setTextAlignment( Qt::AlignHCenter );
 	item->setFlags( Qt::ItemIsSelectable | Qt::ItemIsEnabled );
 	
-	contentsWidget->insertItem( 0, item );
+	// QListWidget
+	contentsWidget->insertItem( contentsWidget->count(), item );
 
+	//QStackedWidget
 	pagesWidget->addWidget( w );
 }
+
+void ConfigDialog::removePage( QWidget *w )
+{
+	int k = pagesWidget->indexOf ( w );
+	contentsWidget->takeItem( k );
+	
+	//QStackedWidget 
+	pagesWidget->removeWidget( w );
+}
+
+
+void ConfigDialog::applyChanges()
+{
+}

Modified: tools/qmdilib/demos/plugin-demo/configdialog.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/configdialog.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/configdialog.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,26 +1,3 @@
-/****************************************************************************
-**
-** Copyright (C) 2005-2006 Trolltech AS. All rights reserved.
-**
-** This file is part of the example classes of the Qt Toolkit.
-**
-** This file may be used under the terms of the GNU General Public
-** License version 2.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of
-** this file.  Please review the following information to ensure GNU
-** General Public Licensing requirements will be met:
-** http://www.trolltech.com/products/qt/opensource.html
-**
-** If you are unsure which license is appropriate for your use, please
-** review the following information:
-** http://www.trolltech.com/products/qt/licensing.html or contact the
-** sales department at sales at trolltech.com.
-**
-** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
-** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
-**
-****************************************************************************/
-
 #ifndef CONFIGDIALOG_H
 #define CONFIGDIALOG_H
 
@@ -28,6 +5,7 @@
 #include <QIcon>
 
 class QIcon;
+class QLabel;
 class QListWidget;
 class QListWidgetItem;
 class QStackedWidget;
@@ -36,16 +14,24 @@
 {
 	Q_OBJECT
 
+	friend class PluginManager;
+
 public:
 	ConfigDialog();
+	~ConfigDialog();
 
 public slots:
 	void changePage(QListWidgetItem *current, QListWidgetItem *previous);
 	void addPage( QWidget *w, QIcon i );
+	void removePage( QWidget *w );
+	void applyChanges();
 
 private:
-	QListWidget *contentsWidget;
-	QStackedWidget *pagesWidget;
+	QListWidget	*contentsWidget;
+	QStackedWidget	*pagesWidget;
+	QPushButton	*applyButton;
+	QPushButton	*closeButton;
+// 	QLabel		*currentPageLabel;
 };
 
 #endif

Modified: tools/qmdilib/demos/plugin-demo/iplugin.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/iplugin.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/iplugin.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -57,6 +57,11 @@
 	return enabled;
 }
 
+QIcon	IPlugin::getIcon()
+{
+	return QIcon("images/config.png");
+}
+
 QString	IPlugin::getName()
 {
 	return name;

Modified: tools/qmdilib/demos/plugin-demo/iplugin.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/iplugin.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/iplugin.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -29,6 +29,7 @@
 	virtual void SaveConfig( QSettings &settings );
 
 	bool 	isEnabled();
+	QIcon	getIcon();
 	QString	getName();
 	QString getAuthor();
 	QString getsVersion();
@@ -44,4 +45,5 @@
 	bool autoEnabled;
 	bool enabled;
 };
+
 #endif // __IPLUGIN_H__

Modified: tools/qmdilib/demos/plugin-demo/mainwindow3.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/mainwindow3.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/mainwindow3.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -26,14 +26,15 @@
 void MainWindow3::initGUI()
 {
 	tabWidget = new qmdiTabWidget(this);
-	setCentralWidget( tabWidget );
 	
 	QToolButton *tabCloseBtn = new QToolButton(tabWidget);
 	tabCloseBtn->setAutoRaise( true );
-// 	connect( tabCloseBtn, SIGNAL(clicked()), this, SLOT(fileClose()));
+	connect( tabCloseBtn, SIGNAL(clicked()), this, SLOT(closeClient()));
 	tabCloseBtn->setIcon(QIcon(":images/closetab.png"));
+	tabWidget->setCornerWidget( tabCloseBtn, Qt::TopRightCorner  );
+	setCentralWidget( tabWidget );
 
-	actionConfig = new QAction( "config", this );
+	actionConfig = new QAction( "&Config", this );
 
 	menus[tr("&File")];
 	menus[tr("&Edit")];
@@ -52,3 +53,13 @@
 	connect( actionConfig, SIGNAL(triggered()), pluginManager, SLOT(configurePlugins()));
 	statusBar()->showMessage("Welcome - feel free to configure the GUI to your needs",5000);
 }
+
+void MainWindow3::closeClient()
+{
+	qmdiClient *client = dynamic_cast<qmdiClient*>( tabWidget->currentWidget());
+
+	if (client == NULL)
+		tabWidget->currentWidget()->deleteLater();
+
+	client->closeClient();
+}

Modified: tools/qmdilib/demos/plugin-demo/mainwindow3.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/mainwindow3.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/mainwindow3.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -17,6 +17,7 @@
 
 public slots:
 	void initGUI();
+	void closeClient();
 	
 private:
 	QTabWidget	*tabWidget;

Modified: tools/qmdilib/demos/plugin-demo/plugin-demo.pro
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugin-demo.pro	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugin-demo.pro	2006-05-05 12:19:05 UTC (rev 79)
@@ -20,8 +20,8 @@
 
 RESOURCES += ../mdi-tab/mdi-tab.qrc
 
-MOC_DIR = ../../tmp 
-UI_DIR = ../../tmp 
+MOC_DIR = .tmp 
+UI_DIR = .tmp 
 OBJECTS_DIR = .tmp 
 CONFIG += debug \
           warn_on 

Modified: tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,5 +1,7 @@
 #include <QAction>
 #include <QMessageBox>
+#include <QFileDialog>
+#include <QMainWindow>
 
 #include "iplugin.h"
 #include "qmdiserver.h"
@@ -10,7 +12,7 @@
 EditorPlugin::EditorPlugin()
 {
 	actionNew	= new_action( QIcon(":images/filenew.png"), tr("&New"), this, tr("Ctrl+N"), tr("Create a new file"), SLOT(fileNew()) );
-	actionOpen	= new_action( QIcon(":images/filenew.png"), tr("&Open"), this, tr("Ctrl+O"), tr("Load a file"), SLOT(fileOpen()) );
+	actionOpen	= new_action( QIcon(":images/fileopen.png"), tr("&Open"), this, tr("Ctrl+O"), tr("Load a file"), SLOT(fileOpen()) );
 
 	name = tr("Text editor plugin");
 	author = tr("Diego Iastrubni <elcuco at kde.org>");
@@ -21,6 +23,18 @@
 
 	menus["&File"]->addAction( actionNew );
 	menus["&File"]->addAction( actionOpen );
+
+// 	toolbars["File"]->addAction( actionNew );
+// 	toolbars["File"]->addAction( actionOpen );
+	
+	configUI = new QWidget;
+	ui.setupUi( configUI );
+
+	makeBackups	= false;
+	showLineNumbers	= true;
+	makeCurrentLine	= true;
+	wordWrap	= true;
+	setData();
 }
 
 EditorPlugin::~EditorPlugin()
@@ -34,6 +48,30 @@
 	QMessageBox::about( NULL, tr("Text Editor plugin"), tr("This plugin brings text editing capabilities to the application") );
 }
 
+QWidget* EditorPlugin::getConfigDialog()
+{
+	return configUI;
+}
+
+void EditorPlugin::getData()
+{
+	makeBackups	= ui.cbMakeBackup->isChecked();
+	showLineNumbers	= ui.cbShowLineNumbers->isChecked();
+	makeCurrentLine	= ui.cbMarkCurrentLine->isChecked();
+	wordWrap	= ui.cbWorkWrap->isChecked();
+}
+
+void EditorPlugin::setData()
+{
+	ui.cbMakeBackup->setChecked( makeBackups );
+	ui.cbShowLineNumbers->setChecked( showLineNumbers );
+	ui.cbMarkCurrentLine->setChecked(makeCurrentLine);
+	ui.cbWorkWrap->setChecked(wordWrap);
+
+	// emit a signal and notify all editors
+	// about the new settings
+}
+
 void EditorPlugin::fileNew()
 {
 	if (!mdiServer)
@@ -44,11 +82,34 @@
 
 	QexTextEdit *editor = new QexTextEdit;
 	editor->hide();
-	editor->name = "No name";
+	editor->name = tr("No name");
 	editor->setObjectName( editor->name );
 	mdiServer->addClient( editor );
 }
 
 void EditorPlugin::fileOpen()
 {
+	if (!mdiServer)
+	{
+		qDebug("%s - warning no mdiServer defined", __FUNCTION__ );
+		return;
+	}
+
+	QString s = QFileDialog::getOpenFileName(
+		NULL,
+	tr("Choose a file"),
+		"",
+		tr("Sources"	,"EditorPlugin::fileOpen: open source files")	+ " (*.c *.cpp *.cxx *.h *.hpp *.hxx *.inc);;" +
+		tr("Headers",	 "EditorPlugin::fileOpen: open header files")	+ " (*.h *.hpp *.hxx *.inc);;"+
+		tr("Qt project", "EditorPlugin::fileOpen: open *.pro")		+ " (*.pro *.pri);;"+
+		tr("All files",  "EditorPlugin::fileOpen: open any file")	+ " (*.*)"
+	);
+
+	if (s.isEmpty())
+		return;
+
+	
+	QexTextEdit *editor = new QexTextEdit( s, dynamic_cast<QMainWindow*>(mdiServer) );
+	editor->hide();
+	mdiServer->addClient( editor );
 }

Modified: tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -2,6 +2,7 @@
 #define __EDITOR_PLUGIN_H__
 
 #include "iplugin.h"
+#include "ui_editor_cfg.h"
 
 class QAction;
 
@@ -13,14 +14,26 @@
 	~EditorPlugin();
 
 	void showAbout();
+	QWidget* getConfigDialog();
+	void getData();
+	void setData();
 
 public slots:
 	void fileNew();
 	void fileOpen();
 	
 private:
-	QAction *actionNew;
-	QAction *actionOpen;
+	QAction		*actionNew;
+	QAction		*actionOpen;
+	Ui::EditorCfgUI	ui;
+	QWidget		*configUI;
+
+	bool	makeBackups;
+	bool	showLineNumbers;
+	bool	makeCurrentLine;
+	bool	wordWrap;
+	QFont	editorFont;
+	int	endOfLine;
 };
 
 #endif// __EDITOR_PLUGIN_H__

Modified: tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,5 +1,5 @@
 <ui version="4.0" >
- <author></author>
+ <author>Diego Iastrubni &lt;elcuco at kde.org></author>
  <comment></comment>
  <exportmacro></exportmacro>
  <class>EditorCfgUI</class>
@@ -8,8 +8,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>287</width>
-    <height>245</height>
+    <width>317</width>
+    <height>325</height>
    </rect>
   </property>
   <property name="windowTitle" >
@@ -51,28 +51,28 @@
            <number>6</number>
           </property>
           <item>
-           <widget class="QCheckBox" name="checkBox" >
+           <widget class="QCheckBox" name="cbMakeBackup" >
             <property name="text" >
              <string>Make backups</string>
             </property>
            </widget>
           </item>
           <item>
-           <widget class="QCheckBox" name="checkBox_2" >
+           <widget class="QCheckBox" name="cbShowLineNumbers" >
             <property name="text" >
              <string>Show line numbers</string>
             </property>
            </widget>
           </item>
           <item>
-           <widget class="QCheckBox" name="checkBox_3" >
+           <widget class="QCheckBox" name="cbMarkCurrentLine" >
             <property name="text" >
              <string>Mark current line</string>
             </property>
            </widget>
           </item>
           <item>
-           <widget class="QCheckBox" name="checkBox_4" >
+           <widget class="QCheckBox" name="cbWorkWrap" >
             <property name="text" >
              <string>Word wrap</string>
             </property>
@@ -90,7 +90,7 @@
           <number>6</number>
          </property>
          <item>
-          <widget class="QToolButton" name="toolButton" >
+          <widget class="QToolButton" name="btnChooseFont" >
            <property name="text" >
             <string>...</string>
            </property>
@@ -131,7 +131,7 @@
           </widget>
          </item>
          <item>
-          <widget class="QComboBox" name="comboBox" >
+          <widget class="QComboBox" name="comboEOL" >
            <item>
             <property name="text" >
              <string>Don't modify</string>
@@ -167,6 +167,7 @@
    </item>
   </layout>
  </widget>
+ <layoutdefault spacing="0" margin="0" />
  <pixmapfunction></pixmapfunction>
  <resources/>
  <connections/>

Modified: tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,8 +1,11 @@
 #include <QAction>
+#include <QProcess>
 #include <QApplication>
 #include <QUrl>
 #include <QLibraryInfo>
 #include <QMessageBox>
+#include <QMainWindow>
+#include <QStatusBar>
 
 #include "iplugin.h"
 #include "qmdiserver.h"
@@ -15,8 +18,10 @@
 {
 	actionAbout	= new_action( QIcon(), tr("&About"), this, "", tr("XXXXX"), SLOT(showAboutApp()) );
 	actionAboutQt	= new_action( QIcon(), tr("&About Qt"), this, "", tr("XXXXX"), SLOT(showAboutQt()) );
- 	actionShowQtHelp= new_action( QIcon(), tr("&Qt help"), this, "", tr("XXXXX"), SLOT(showQtHelp()) );
+	actionShowQtHelp= new_action( QIcon(), tr("&Qt help"), this, "F1", tr("XXXXX"), SLOT(showQtHelp()) );
 
+// 	actionAbout->setShortcut( "F1" );
+
 	name = "Help plugin";
 	author = "Diego Iastrubni <elcuco at kde.org>";
 	iVersion = 0;
@@ -28,6 +33,8 @@
 	menus["&Help"]->addSeparator();
 	menus["&Help"]->addAction( actionAbout );
 	menus["&Help"]->addAction( actionAboutQt );
+
+// 	externalBrowser = "/opt/kde3/bin/konqueror";
 }
 
 HelpPlugin::~HelpPlugin()
@@ -54,9 +61,32 @@
 void HelpPlugin::showQtHelp()
 {
 	QString helpFile = QLibraryInfo::location(QLibraryInfo::DocumentationPath) + QLatin1String("/html/index.html");
+	
 	QexHelpBrowser *browser = new QexHelpBrowser( QUrl(helpFile) );
 	browser->hide();
 	browser->name = "Qt help";
 	browser->setObjectName( browser->name );
+	connect( browser, SIGNAL(sourceChanged(QUrl)), this, SLOT(on_browser_sourceChanged(QUrl)));
+	
 	mdiServer->addClient( browser );
 }
+
+void HelpPlugin::on_browser_sourceChanged ( const QUrl & src )
+{
+	if (externalBrowser.isEmpty())
+		return;
+
+	if ((src.scheme() == "file") || (src.scheme().isEmpty()))
+		    return;
+	
+	if (!QProcess::startDetached( externalBrowser, QStringList(src.toString()) ))
+	{
+		QWidget *w = dynamic_cast<QWidget*>(mdiServer);
+		if (w == NULL)
+			return;
+			
+		QMainWindow *ww = dynamic_cast<QMainWindow*>(w->window());
+		if (ww)
+			ww->statusBar()->showMessage("Error: could not start external browser", 5000);
+	}
+}

Modified: tools/qmdilib/demos/plugin-demo/plugins/help/help.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/help/help.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/help/help.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -4,6 +4,7 @@
 #include "iplugin.h"
 
 class QAction;
+class QUrl;
 
 class HelpPlugin: public IPlugin
 {
@@ -17,11 +18,15 @@
 	void showAboutApp();
 	void showAboutQt();
 	void showQtHelp();
+
+	void on_browser_sourceChanged ( const QUrl & src );
 	
 private:
 	QAction *actionAbout;
 	QAction *actionAboutQt;
 	QAction *actionShowQtHelp;
+
+	QString externalBrowser;
 };
 
 #endif// __HELP_PLUGIN_H__

Modified: tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui	2006-05-05 12:19:05 UTC (rev 79)
@@ -8,8 +8,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>287</width>
-    <height>245</height>
+    <width>418</width>
+    <height>285</height>
    </rect>
   </property>
   <property name="windowTitle" >
@@ -23,148 +23,108 @@
     <number>6</number>
    </property>
    <item>
-    <widget class="QTabWidget" name="tabWidget" >
-     <property name="currentIndex" >
+    <widget class="QLabel" name="label_3" >
+     <property name="text" >
+      <string>&lt;html>&lt;head>&lt;meta name="qrichtext" content="1" />&lt;/head>&lt;body style=" white-space: pre-wrap; font-family:FreeSans; font-size:10pt; font-weight:400; font-style:normal; text-decoration:none;">&lt;p style=" margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600;">&lt;font size="6">&lt;font size="6">Help Browser Configuration&lt;/font>&lt;/font>&lt;/p>&lt;p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> The internal browser cannot handle external links, or PDF files. When you click some links, their content will be displayed with these applications.&lt;/p>&lt;/body>&lt;/html></string>
+     </property>
+     <property name="textFormat" >
+      <enum>Qt::RichText</enum>
+     </property>
+     <property name="scaledContents" >
+      <bool>true</bool>
+     </property>
+     <property name="wordWrap" >
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item>
+    <widget class="Line" name="line" >
+     <property name="orientation" >
+      <enum>Qt::Horizontal</enum>
+     </property>
+    </widget>
+   </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
       <number>0</number>
      </property>
-     <widget class="QWidget" name="tab" >
-      <attribute name="title" >
-       <string>General</string>
-      </attribute>
-      <layout class="QVBoxLayout" >
-       <property name="margin" >
-        <number>9</number>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QLabel" name="label_2" >
+       <property name="text" >
+        <string>External browser</string>
        </property>
-       <property name="spacing" >
-        <number>6</number>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
        </property>
-       <item>
-        <widget class="QGroupBox" name="groupBox" >
-         <property name="title" >
-          <string>GroupBox</string>
-         </property>
-         <layout class="QVBoxLayout" >
-          <property name="margin" >
-           <number>9</number>
-          </property>
-          <property name="spacing" >
-           <number>6</number>
-          </property>
-          <item>
-           <widget class="QCheckBox" name="checkBox" >
-            <property name="text" >
-             <string>Make backups</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QCheckBox" name="checkBox_2" >
-            <property name="text" >
-             <string>Show line numbers</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QCheckBox" name="checkBox_3" >
-            <property name="text" >
-             <string>Mark current line</string>
-            </property>
-           </widget>
-          </item>
-          <item>
-           <widget class="QCheckBox" name="checkBox_4" >
-            <property name="text" >
-             <string>Word wrap</string>
-            </property>
-           </widget>
-          </item>
-         </layout>
-        </widget>
-       </item>
-       <item>
-        <layout class="QHBoxLayout" >
-         <property name="margin" >
-          <number>0</number>
-         </property>
-         <property name="spacing" >
-          <number>6</number>
-         </property>
-         <item>
-          <widget class="QToolButton" name="toolButton" >
-           <property name="text" >
-            <string>...</string>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QLabel" name="label" >
-           <property name="text" >
-            <string>Editor font</string>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QLineEdit" name="lineEdit" >
-           <property name="enabled" >
-            <bool>false</bool>
-           </property>
-           <property name="readOnly" >
-            <bool>true</bool>
-           </property>
-          </widget>
-         </item>
-        </layout>
-       </item>
-       <item>
-        <layout class="QHBoxLayout" >
-         <property name="margin" >
-          <number>0</number>
-         </property>
-         <property name="spacing" >
-          <number>6</number>
-         </property>
-         <item>
-          <widget class="QLabel" name="label_2" >
-           <property name="text" >
-            <string>End of line</string>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QComboBox" name="comboBox" >
-           <item>
-            <property name="text" >
-             <string>Don't modify</string>
-            </property>
-           </item>
-           <item>
-            <property name="text" >
-             <string>Unix (CR)</string>
-            </property>
-           </item>
-           <item>
-            <property name="text" >
-             <string>DOS/Window (CR/LF)</string>
-            </property>
-           </item>
-           <item>
-            <property name="text" >
-             <string>Mac (LF)</string>
-            </property>
-           </item>
-          </widget>
-         </item>
-        </layout>
-       </item>
-      </layout>
-     </widget>
-     <widget class="QWidget" name="tab_2" >
-      <attribute name="title" >
-       <string>Tab 2</string>
-      </attribute>
-     </widget>
-    </widget>
+       <property name="sizeHint" >
+        <size>
+         <width>137</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="QLineEdit" name="lineEdit" />
+     </item>
+     <item>
+      <widget class="QToolButton" name="toolButton" >
+       <property name="text" >
+        <string>...</string>
+       </property>
+      </widget>
+     </item>
+    </layout>
    </item>
+   <item>
+    <layout class="QHBoxLayout" >
+     <property name="margin" >
+      <number>0</number>
+     </property>
+     <property name="spacing" >
+      <number>6</number>
+     </property>
+     <item>
+      <widget class="QLabel" name="label" >
+       <property name="text" >
+        <string>PDF viewer</string>
+       </property>
+      </widget>
+     </item>
+     <item>
+      <spacer>
+       <property name="orientation" >
+        <enum>Qt::Horizontal</enum>
+       </property>
+       <property name="sizeHint" >
+        <size>
+         <width>143</width>
+         <height>20</height>
+        </size>
+       </property>
+      </spacer>
+     </item>
+     <item>
+      <widget class="QLineEdit" name="lineEdit_2" />
+     </item>
+     <item>
+      <widget class="QToolButton" name="toolButton_2" >
+       <property name="text" >
+        <string>...</string>
+       </property>
+      </widget>
+     </item>
+    </layout>
+   </item>
   </layout>
  </widget>
  <pixmapfunction></pixmapfunction>

Modified: tools/qmdilib/demos/plugin-demo/pluningmanager.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/pluningmanager.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/pluningmanager.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -20,7 +20,7 @@
 
 /**
  * \brief A class which manages a list of plugins and merges their menus and toolbars to the main application
- * \author Diego Iastrubni <elcuco at kde.org>
+ * \author Diego Iastrubni (elcuco at kde.org)
  * 
  */
 PluginManager::PluginManager( qmdiHost *host, qmdiServer *server )
@@ -31,17 +31,28 @@
 	QWidget *w = new QWidget;
 	ui.setupUi( w );
 	w->setObjectName("config");
-	
+
+	connect( dlg.applyButton, SIGNAL(clicked()), this, SLOT(on_apply_dialog()));
+	connect( dlg.closeButton, SIGNAL(clicked()), this, SLOT(on_close_dialog()));
+
+	// define the main configuration panel
 	pluginModel = new PluginModel( &plugins );
 	ui.listWidget->setModel( pluginModel );
 	connect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 	connect( ui.btnAbout, SIGNAL(clicked()), this, SLOT(on_aboutPlugin_clicked()));
-	
 	connect( ui.listWidget, SIGNAL(activated(QModelIndex)), this, SLOT(on_listWidget_activated(QModelIndex)));
 	connect( ui.listWidget, SIGNAL(entered(QModelIndex)), this, SLOT(on_listWidget_activated(QModelIndex)));
 	connect( ui.listWidget, SIGNAL(clicked(QModelIndex)), this, SLOT(on_listWidget_activated(QModelIndex)));
 
 	dlg.addPage( w, QIcon("images/config.png") );
+
+	/*
+	mainOpen = new QAction( "New Multi Open", this );
+	menus["&File"]->addAction( mainOpen );
+	connect( mainOpen, SIGNAL(triggered()), this, SLOT(on_mainOpen_clicked()));
+	if (mdiHost)
+		mdiHost->mergeClient( this );
+	*/
 }
 
 PluginManager::~PluginManager()
@@ -63,6 +74,11 @@
 	if (!newplugin)
 		return;
 
+	// when the checkboxes state is modified, a signal is been emited
+	// we need to ignore this for this function. re-connected at the end of this
+	// function
+	disconnect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
+	
 	QModelIndex parent = pluginModel->index(0, 0, parent);
 	int count = pluginModel->columnCount();
 	
@@ -79,6 +95,9 @@
 	{
 		newplugin->enabled = true;
 		mdiHost->mergeClient( newplugin );
+	
+		if (newplugin->getConfigDialog() != NULL)
+			dlg.addPage( newplugin->getConfigDialog(), newplugin->getIcon() );
 	}
 
 
@@ -98,6 +117,8 @@
 // 		TODO why does this crash?
 // 		ui.cbEnabled->setChecked( newplugin->isEnabled() );
 	}
+
+	connect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 }
 
 // called when the user seleccts a new plugin
@@ -108,6 +129,10 @@
 	if (!plugin)
 		return;
 
+	// when the checkboxes state is modified, a signal is been emited
+	// we need to ignore this for this function. re-connected at the end of this
+	// function
+	disconnect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 	ui.pluginName->setText( plugin->getName() );
 	ui.pluginName->setCursorPosition( 0 );
 	
@@ -119,6 +144,7 @@
 
 	ui.cbEnabled->setEnabled( !plugin->alwaysEnabled );
 	ui.cbEnabled->setChecked( plugin->isEnabled() );
+	connect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 }
 
 // called when the user checks on unchecks to enable a plugin
@@ -132,15 +158,21 @@
 
 	plugin->enabled = checked;
 	if (checked)
-	{		
-		// TODO add also the configuration dialog for this plugin
+	{
+		if (plugin->getConfigDialog() != NULL)
+			dlg.addPage( plugin->getConfigDialog(), plugin->getIcon() );
+
+		plugin->setData();
 		mdiHost->mergeClient( plugin );
 	}
 	else
 	{
-		// TODO remove also the configuration dialog for this plugin
+		if (plugin->getConfigDialog() != NULL)
+			dlg.removePage( plugin->getConfigDialog() );
+		
 		mdiHost->unmergeClient( plugin );
 	}
+	
 	mdiHost->updateGUI( dynamic_cast<QMainWindow*>(mdiHost) );
 }
 
@@ -157,6 +189,34 @@
 	
 	plugin->showAbout();
 
+	// TODO still now what i want, still the dialog has no focus after the
+	// about box of the plugin
 	dlg.raise();
 	dlg.setFocus();
 }
+
+void PluginManager::on_mainOpen_clicked()
+{
+	qDebug( "ping" );
+}
+
+void PluginManager::on_apply_dialog()
+{
+	IPlugin	*p;
+	foreach( p, plugins )
+	{
+		if (p->enabled)
+			p->getData();
+	}
+}
+
+void PluginManager::on_close_dialog()
+{
+	IPlugin	*p;
+	foreach( p, plugins )
+	{
+		if (p->enabled)
+			p->setData();
+	}
+}
+

Modified: tools/qmdilib/demos/plugin-demo/pluningmanager.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/pluningmanager.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/pluningmanager.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -13,6 +13,7 @@
 #define PLUNINGMANAGER_H
 
 #include <QObject>
+#include "qmdiclient.h"
 #include "configdialog.h"
 #include "ui_plugin_list.h"
 
@@ -23,7 +24,7 @@
 class PluginModel;
 class QStandardItemModel;
 
-class PluginManager: public QObject
+class PluginManager: public QObject, public qmdiClient
 {
 	Q_OBJECT
 	
@@ -37,7 +38,11 @@
 	void on_listWidget_activated(const QModelIndex & index );
 	void on_cbEnabled_togglged( bool checked );
 	void on_aboutPlugin_clicked();
-	
+	void on_mainOpen_clicked();
+
+	void on_apply_dialog();
+	void on_close_dialog();
+
 private:
 	QList<IPlugin*>		plugins;
 	QStandardItemModel	*pluginModel;
@@ -45,6 +50,8 @@
 	qmdiServer		*mdiServer;
 	ConfigDialog		dlg;
 	Ui::plugin_list ui;
+
+// 	QAction			*mainOpen;
 };
 
 #endif



From elcuco at berlios.de  Sat May  6 20:51:30 2006
From: elcuco at berlios.de (elcuco at berlios.de)
Date: Sat, 6 May 2006 20:51:30 +0200
Subject: [Devqt-devel] r80 - tools/qmdilib/demos/plugin-demo
Message-ID: <200605061851.k46IpUZk014594@sheep.berlios.de>

Author: elcuco
Date: 2006-05-06 20:51:23 +0200 (Sat, 06 May 2006)
New Revision: 80

Modified:
   tools/qmdilib/demos/plugin-demo/plugin-demo.pro
Log:
Compilation fixes on win32:
The files which need to be "UIC"ed must be at the top of the list. For some reason, this is the only way it works on win32, even tough on unix it works perfectly. Also removed the debug on win32 builds as I did not compile my Qt4.1.1 with debug info :)

Modified: tools/qmdilib/demos/plugin-demo/plugin-demo.pro
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugin-demo.pro	2006-05-05 12:19:05 UTC (rev 79)
+++ tools/qmdilib/demos/plugin-demo/plugin-demo.pro	2006-05-06 18:51:23 UTC (rev 80)
@@ -22,30 +22,38 @@
 
 MOC_DIR = .tmp 
 UI_DIR = .tmp 
-OBJECTS_DIR = .tmp 
-CONFIG += debug \
-          warn_on 
+OBJECTS_DIR = .tmp 
+unix{
+    CONFIG += debug warn_on 
+}
+
+win32{
+    CONFIG -= debug
+}
+
 TEMPLATE = app 
 FORMS += plugins/editor/editor_cfg.ui \
          plugins/help/help_cfg.ui \
          plugin_list.ui 
 IDLS += plugin_list.ui 
 HEADERS += configdialog.h \
-           iplugin.h \
-           mainwindow3.h \
+           plugins/help/help.h \
+           plugins/editor/editor.h \
+           iplugin.h \
+           mainwindow3.h \
+           pluningmanager.h \
+           pluginmodel.h \
            ../../src/actiongroup.h \
            ../../src/actiongrouplist.h \
            ../../src/qmdiclient.h \
            ../../src/qmdihost.h \
            ../../src/qmdiserver.h \
            ../../src/qmditabwidget.h \
-           pluningmanager.h \
-           pluginmodel.h \
-           plugins/help/help.h \
-           plugins/editor/editor.h \
            ../mdi-tab/helpbrowse.h \
            ../mdi-tab/qexeditor.h 
 SOURCES += configdialog.cpp \
+           plugins/help/help.cpp \
+           plugins/editor/editor.cpp \
            iplugin.cpp \
            main3.cpp \
            mainwindow3.cpp \
@@ -57,7 +65,5 @@
            ../../src/qmditabwidget.cpp \
            pluningmanager.cpp \
            pluginmodel.cpp \
-           plugins/help/help.cpp \
-           plugins/editor/editor.cpp \
            ../mdi-tab/helpbrowse.cpp \
            ../mdi-tab/qexeditor.cpp 



From elcuco at berlios.de  Sun May  7 20:10:54 2006
From: elcuco at berlios.de (elcuco at berlios.de)
Date: Sun, 7 May 2006 20:10:54 +0200
Subject: [Devqt-devel] r81 - tools/qmdilib/src
Message-ID: <200605071810.k47IAsLP021534@sheep.berlios.de>

Author: elcuco
Date: 2006-05-07 20:10:47 +0200 (Sun, 07 May 2006)
New Revision: 81

Modified:
   tools/qmdilib/src/qmditabwidget.cpp
   tools/qmdilib/src/qmditabwidget.h
Log:

new feature popup menus per mdi client

if you right click the tabbar of the tabwidget, you will have a new
popup menu, which asks if you want to close this widget, the others, or
all the widgets available.

todo:
memory deallocations
merging with a mdiclient pre defined menu




Modified: tools/qmdilib/src/qmditabwidget.cpp
===================================================================
--- tools/qmdilib/src/qmditabwidget.cpp	2006-05-06 18:51:23 UTC (rev 80)
+++ tools/qmdilib/src/qmditabwidget.cpp	2006-05-07 18:10:47 UTC (rev 81)
@@ -1,5 +1,8 @@
+#include <QEvent>
+#include <QMouseEvent>
+#include <QAction>
+#include <QMenu>
 #include <QMainWindow>
-#include <QAction>
 
 #include "qmditabwidget.h"
 #include "qmdihost.h"
@@ -14,8 +17,50 @@
  * \see qmdiServer, QTabWidget
  */
 
+/**
+ * \class qmdiTabBar
+ * \brief helper class for qmdiTabWidget
+ */
 
 /**
+ * \brief mouse pressed event handler
+ * \param event
+ *
+ * This is an overloaded function, which will emit a signal
+ * with the tab number which was pressed. There are 2 signals
+ * emited: middleMousePressed(int) and rightMousePressed(int)
+ */
+void qmdiTabBar::mousePressEvent ( QMouseEvent * event )
+{
+	if (event->button() == Qt::MidButton)
+	{
+		int tabCount = count();
+		for( int i=0; i<tabCount; i++ )
+		{
+			if (tabRect(i).contains(event->pos()))
+			{
+				emit middleMousePressed(i, event->pos());
+				break;
+			}
+		}
+	}
+	else if (event->button() == Qt::RightButton)
+	{
+		int tabCount = count();
+		for( int i=0; i<tabCount; i++ )
+		{
+			if (tabRect(i).contains(event->pos()))
+			{
+				emit rightMousePressed(i, event->pos());
+				break;
+			}
+		}
+	}
+
+	QTabBar::mousePressEvent(event);
+}
+
+/**
  * \class qmdiTabWidget
  * \brief an advanced tab widget, which is capable of changing menus and toolbars on the fly
  * 
@@ -63,6 +108,11 @@
 	activeWidget = NULL;
 	
 	connect( this, SIGNAL(currentChanged(int)), this, SLOT(tabChanged(int)));
+
+	QTabBar *b = new qmdiTabBar;
+	connect( b, SIGNAL(middleMousePressed(int,QPoint)), this, SLOT(tryCloseClient(int)));
+	connect( b, SIGNAL(rightMousePressed(int,QPoint)), this, SLOT(showClientMenu(int,QPoint)));
+	setTabBar( b );
 }
 
 
@@ -99,11 +149,108 @@
 		mdiHost->mergeClient( dynamic_cast<qmdiClient*>(activeWidget) );
 
 	QMainWindow *m = dynamic_cast<QMainWindow*>(mdiHost);
-	mdiHost->updateGUI( m );
+	mdiHost->updateGUI( m );	
 }
 
 
 /**
+ * \brief request an mdi client to close
+ * \param i the number of the client (tab) to be closed
+ *
+ * Call this slot to ask the mdi client to close itself.
+ * The mdi client may show a dialog to ask for saving. It's not
+ * ganranteed that the action will be handled as the mdi client
+ * can abort the action.
+ *
+ * \see qmdiClient::closeClient()
+ */
+void qmdiTabWidget::tryCloseClient( int i )
+{
+	qmdiClient *client = dynamic_cast<qmdiClient*>(widget(i));
+	if (!client)
+		return;
+
+	client->closeClient();
+}
+
+
+/**
+ * \brief request to close all other clients
+ * \param i the number of the client to keep open
+ *
+ * Call this slot to ask all the mdi clients (but the i parameter).
+ * Each mdi client may show a dialog to ask for saving. It's not
+ * ganranteed that the action will be handled as the mdi client
+ * can abort the action. At the end, only the client number i will
+ * not be asked to close itself.
+ *
+ * \see qmdiClient::closeClient() tryCloseClient() tryCloseAllCliens
+ */
+void qmdiTabWidget::tryCloseAllButClient( int i )
+{
+	int c = count();
+
+	for( int j=0; j<c; j++ )
+	{
+		if (j == i)
+			continue;
+		
+		qmdiClient *client = dynamic_cast<qmdiClient*>(widget(j));
+		if (!client)
+			continue;
+
+		client->closeClient();
+	}
+}
+
+
+/**
+ * \brief try to close all mdi clients
+ *
+ * Call this slot when you want to close all the mdi clients.
+ */
+void qmdiTabWidget::tryCloseAllCliens()
+{
+	int c = count();
+
+	for( int i=0; i<c; i++ )
+	{
+		qmdiClient *client = dynamic_cast<qmdiClient*>(widget(i));
+		if (!client)
+			continue;
+
+		client->closeClient();
+	}	
+}
+
+
+void qmdiTabWidget::showClientMenu( int i, QPoint p )
+{
+	QAction *closeThis	= new QAction(tr("Close this window"), this);
+	QAction *closeOthers	= new QAction(tr("Close other windows"), this);
+	QAction *closeAll	= new QAction(tr("Close all windows"), this);
+	QMenu *menu = new QMenu( tr("Local actions") );
+	menu->addAction( closeThis );
+	menu->addAction( closeOthers );
+	menu->addAction( closeAll );
+
+	QAction *q = menu->exec( this->mapToGlobal(p) );
+
+	if ( q == closeThis)
+	{
+		tryCloseClient( i );
+	}
+	else if  (q == closeOthers)
+	{
+		tryCloseAllButClient( i );
+	}
+	else if (q == closeAll )
+	{
+		tryCloseAllCliens();
+	}
+}
+
+/**
  * \brief callback to get alarm of deleted object
  * \param o the deleted object
  * 

Modified: tools/qmdilib/src/qmditabwidget.h
===================================================================
--- tools/qmdilib/src/qmditabwidget.h	2006-05-06 18:51:23 UTC (rev 80)
+++ tools/qmdilib/src/qmditabwidget.h	2006-05-07 18:10:47 UTC (rev 81)
@@ -10,11 +10,25 @@
  */
  
 #include <QTabWidget>
+#include <QTabBar>
 #include "qmdiserver.h"
 
 class QWidget;
+class QPoint;
 class qmdiHost;
 
+class qmdiTabBar: public QTabBar
+{
+	Q_OBJECT
+
+	protected:
+		void mousePressEvent ( QMouseEvent * event );
+		
+	signals:
+		void middleMousePressed(int tabNumber, QPoint where );
+		void rightMousePressed(int tabNumber, QPoint where );
+};
+
 class qmdiTabWidget : public QTabWidget, public qmdiServer
 {
 	Q_OBJECT
@@ -23,12 +37,15 @@
 
 public slots:
 	void tabChanged( int i );
+	void tryCloseClient( int i );
+	void tryCloseAllButClient( int i );
+	void tryCloseAllCliens();
+	void showClientMenu( int i, QPoint p );
 
 protected:
 	void clientDeleted( QObject *o );
 	void tabInserted ( int index );
 	void tabRemoved ( int index );
-	
 	void addClient( qmdiClient *client );
 	
 private:



From elcuco at kde.org  Wed May 10 23:03:36 2006
From: elcuco at kde.org (Diego Iastrubni)
Date: Wed, 10 May 2006 23:03:36 +0200
Subject: [Devqt-devel] wiki is been born
Message-ID: <44625528.2080901@kde.org>

Hi all,

I started adding a wiki to devqt's page. It's quite usable now, and I 
starting to begin to understand how to use the wiki software. I have 
added some pages, and initial ideas about the wiki structure.

Feel free to explore, you will have to log in to edit pages, and the 
main page is locked (there is an open version in the development portal).

http://devqt.berlios.de/wiki/

- diego


From elcuco at kde.org  Fri May 12 20:35:57 2006
From: elcuco at kde.org (Diego Iastrubni)
Date: Fri, 12 May 2006 21:35:57 +0300
Subject: [Devqt-devel] Re: Need qmdilib fix
In-Reply-To: <44642407.20705@gmail.com>
References: <4462EE04.90202@gmail.com> <200605112211.38333.elcuco@kde.org> <44642407.20705@gmail.com>
Message-ID: <200605122135.57953.elcuco@kde.org>

Hi,

I have looked at the problem you describe. Interesting....

The application is just not loaded by windows... there is nothing to debug, 
since the application itself is not loading. The code seems to be ok, not 
only since "it looks ok", but it runs on Linux. This leads me to think that 
mingw just sux. 

I will try and reproduce the problem on a small test case, and see how can I 
overcome it, and if needed I will report the trolls. 

Meanwhile, some of the functions you added to your widget were added to 
qmdiTab, now you can right click the tabs and get  a menu with options to 
close this, all others or all mdi clients. A middle click will try and close 
the mdi client. I will also hadd the option to merge-in new menus from the 
mdi client into that menu. 

Still, what you reproduce is unacceptable. I will have to fix this, or work 
around it.

Please wait a few days, and I will send you the new source.

???? ????, 12 ???? 2006, 08:58, ???? ?? ??? Nox PasNox:
> Hi,
>
> Thanks, P at sNox,
>
> > Hi,
> >
> > Since yesterday, I have no active SVN, as devqt got officially closed by
> > me. I see no reason to continue working on that SVN and beeing part of
> > that project. This means that there is not official place for you to get
> > new versions for qmdilib. I will try to fix this situation in the next
> > week.
> >
> > Meanwhile, I will try to find the cause of the crash you see. I will give
> > you an updated version in a few days.
> >
> > ???? ?????, 11 ???? 2006, 10:55, ????:
> >> Hi,
> >>
> >> Here is my current new dirty branch of Qt4DS Monkey next major release.
> >> It compil and run fine under Unix/Linux ( and maybe Mac OS X ).
> >> It compil fine under windows, but can't start application, there is an
> >> application error on start.
> >> As i already say u, i know that it s the qmdilib that do this when i
> >> subclass qmditabwidget.
> >> But i have not search the real cause in qmdilib source code ( maybe it
> >> could be in my source but i really doubth about this ).
> >>
> >> If u have a new version, try send me paybe it will fix it.
> >> In any case, i ask u i u can take a little time, to compil tis under
> >> windows and test/debug your lib.
> >>
> >> Thanks, P at sNox,


From becker at plaasoft.com  Thu May 25 08:27:26 2006
From: becker at plaasoft.com (Florian Becker)
Date: Thu, 25 May 2006 08:27:26 +0200
Subject: [Devqt-devel] DevQt
Message-ID: <200605250827.26896.becker@plaasoft.com>

Hi,

what is the last status of devqt? Is a plugin based client ready now? Or were 
shall i begin to work?

I have some svn code, but that cannot the whole thing? So, if you give me the 
url to latest svn fork, so i'll drop you some tools/plugins.

regards
-- 
--------------------------------------------------------
Florian Becker
becker at plaasoft.com

PlaaSoft Technologies
Rosenplatz 1
D - 92224 Amberg / Gailoh

http://www.plaasoft.com

Telefon: +49 96 21 / 60 70 50
Telefax: +49 96 21 / 60 70 51
--------------------------------------------------------


