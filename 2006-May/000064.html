<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Devqt-devel] r79 - in tools/qmdilib/demos/plugin-demo: . plugins/editor plugins/help
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/devqt-devel/2006-May/index.html" >
   <LINK REL="made" HREF="mailto:devqt-devel%40lists.berlios.de?Subject=Re%3A%20%5BDevqt-devel%5D%20r79%20-%20in%20tools/qmdilib/demos/plugin-demo%3A%20.%20plugins/editor%20plugins/help&In-Reply-To=%3C200605051219.k45CJlIe018860%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000063.html">
   <LINK REL="Next"  HREF="000065.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Devqt-devel] r79 - in tools/qmdilib/demos/plugin-demo: . plugins/editor plugins/help</H1>
    <B>elcuco at berlios.de</B> 
    <A HREF="mailto:devqt-devel%40lists.berlios.de?Subject=Re%3A%20%5BDevqt-devel%5D%20r79%20-%20in%20tools/qmdilib/demos/plugin-demo%3A%20.%20plugins/editor%20plugins/help&In-Reply-To=%3C200605051219.k45CJlIe018860%40sheep.berlios.de%3E"
       TITLE="[Devqt-devel] r79 - in tools/qmdilib/demos/plugin-demo: . plugins/editor plugins/help">elcuco at berlios.de
       </A><BR>
    <I>Fri May  5 14:19:47 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000063.html">[Devqt-devel] RE : new branch alpha 3
</A></li>
        <LI>Next message: <A HREF="000065.html">[Devqt-devel] r80 - tools/qmdilib/demos/plugin-demo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64">[ date ]</a>
              <a href="thread.html#64">[ thread ]</a>
              <a href="subject.html#64">[ subject ]</a>
              <a href="author.html#64">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: elcuco
Date: 2006-05-05 14:19:05 +0200 (Fri, 05 May 2006)
New Revision: 79

Modified:
   tools/qmdilib/demos/plugin-demo/configdialog.cpp
   tools/qmdilib/demos/plugin-demo/configdialog.h
   tools/qmdilib/demos/plugin-demo/iplugin.cpp
   tools/qmdilib/demos/plugin-demo/iplugin.h
   tools/qmdilib/demos/plugin-demo/mainwindow3.cpp
   tools/qmdilib/demos/plugin-demo/mainwindow3.h
   tools/qmdilib/demos/plugin-demo/plugin-demo.pro
   tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp
   tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h
   tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui
   tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp
   tools/qmdilib/demos/plugin-demo/plugins/help/help.h
   tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui
   tools/qmdilib/demos/plugin-demo/pluningmanager.cpp
   tools/qmdilib/demos/plugin-demo/pluningmanager.h
Log:
This is a large commit, sorry for this :)

 - The plugin manager will try to close client
   with the defined interfaces. This means that you
   will be asekd to save your work if needed after
   you click the close command.
 - Remade the configuration dialog layout, now looks better IMHO,
   as one whole dialog and not as 3 widgets separated.
 - Various fixes on the configuration dialog as well.
 - Each IPlugin as an icon. A sane default is provided.
 - The plugins now can set the data to the dialog and get it
   on demand. When the user presses &quot;Apply&quot; all the enabled pluings
   will call &quot;getData()&quot; and on close (yes, on close) the function
   &quot;setData()&quot;, which will overite the previous settings (the
   Close button on the dialog is treaed as cancel). 
   On real life implementations, plugins should emit a signal on the
   setData function, to announce all the mdi clients generated by it,
   that they should update the display (all text editor should modify 
   their font).
 - The help browser has the ability to run external browsers when
   a non supported link has been clicked. On many pages of the Qt 
   help we can find links to &quot;<A HREF="http://....">http://....</A>&quot; which are not supported by 
   QTextBrowser. Users should visit this with a proper browser for this 
   anyway. Currently no configuration has been made, and it defauts to
   an empty browser, which means this functionality is disabled.
 - Added a mainpage.dox stub. I need to start thinking about betetr documentation.
   


Modified: tools/qmdilib/demos/plugin-demo/configdialog.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/configdialog.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/configdialog.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,62 +1,56 @@
-/****************************************************************************
-**
-** Copyright (C) 2005-2006 Trolltech AS. All rights reserved.
-**
-** This file is part of the example classes of the Qt Toolkit.
-**
-** This file may be used under the terms of the GNU General Public
-** License version 2.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of
-** this file.  Please review the following information to ensure GNU
-** General Public Licensing requirements will be met:
-** <A HREF="http://www.trolltech.com/products/qt/opensource.html">http://www.trolltech.com/products/qt/opensource.html</A>
-**
-** If you are unsure which license is appropriate for your use, please
-** review the following information:
-** <A HREF="http://www.trolltech.com/products/qt/licensing.html">http://www.trolltech.com/products/qt/licensing.html</A> or contact the
-** sales department at <A HREF="https://lists.berlios.de/mailman/listinfo/devqt-devel">sales at trolltech.com.</A>
-**
-** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
-** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
-**
-****************************************************************************/
-
 #include &lt;QtGui&gt;
 #include &lt;QIcon&gt;
+#include &lt;QLabel&gt;
 
 #include &quot;configdialog.h&quot;
-// #include &quot;pages.h&quot;
 
 ConfigDialog::ConfigDialog()
 {
+	setSizeGripEnabled(true);
+	
 	contentsWidget = new QListWidget;
 	contentsWidget-&gt;setViewMode(QListView::IconMode);
 	contentsWidget-&gt;setIconSize(QSize(96, 84));
 	contentsWidget-&gt;setMovement(QListView::Static);
 	contentsWidget-&gt;setMaximumWidth(128);
-// 	contentsWidget-&gt;setSpacing(12);
-// 	contentsWidget-&gt;setModelColumn( 0 );
+	contentsWidget-&gt;setSpacing( 0 );
+	contentsWidget-&gt;setModelColumn( 0 );
 	contentsWidget-&gt;setFlow( QListView::TopToBottom );
+	
+	pagesWidget = new QStackedWidget(this);
+	applyButton = new QPushButton(tr(&quot;&amp;Apply&quot;));
+	closeButton = new QPushButton(tr(&quot;&amp;Close&quot;));
 
+	QHBoxLayout *mainLayout		= new QHBoxLayout(this);
+	QVBoxLayout *vLayout		= new QVBoxLayout;
+	QHBoxLayout *buttonsLayout	= new QHBoxLayout;
+
+	vLayout-&gt;setObjectName(&quot;vLayout&quot;);
+	buttonsLayout-&gt;setObjectName(&quot;buttonsLayout&quot;);
+	mainLayout-&gt;setObjectName(&quot;mainLayout&quot;);
 	
-	pagesWidget = new QStackedWidget;
-	QPushButton *closeButton = new QPushButton(tr(&quot;Close&quot;));
+// 	QFrame *line1 = new QFrame;
+	QFrame *line2 = new QFrame;
+// 	currentPageLabel = new QLabel;
 	
-	QHBoxLayout *horizontalLayout = new QHBoxLayout;
-	horizontalLayout-&gt;addWidget(contentsWidget);
-	horizontalLayout-&gt;addWidget(pagesWidget, 1);
+// 	line1-&gt;setFrameShape(QFrame::HLine);
+	line2-&gt;setFrameShape(QFrame::HLine);
 	
-	QHBoxLayout *buttonsLayout = new QHBoxLayout;
 	buttonsLayout-&gt;addStretch(1);
+	buttonsLayout-&gt;addWidget(applyButton);
 	buttonsLayout-&gt;addWidget(closeButton);
+
+// 	vLayout-&gt;addWidget( currentPageLabel );
+// 	vLayout-&gt;addWidget( line1 );
+	vLayout-&gt;addWidget( pagesWidget );
+	vLayout-&gt;addWidget( line2 );
+	vLayout-&gt;addLayout( buttonsLayout );
 	
-	QVBoxLayout *mainLayout = new QVBoxLayout;
-	mainLayout-&gt;addLayout(horizontalLayout);
-	mainLayout-&gt;addStretch(1);
-	mainLayout-&gt;addSpacing(12);
-	mainLayout-&gt;addLayout(buttonsLayout);
+	mainLayout-&gt;addWidget(contentsWidget);
+	mainLayout-&gt;addLayout(vLayout);
 	setLayout(mainLayout);
 	
+	connect(applyButton, SIGNAL(clicked()), this, SLOT(applyChanges()));
 	connect(closeButton, SIGNAL(clicked()), this, SLOT(close()));
 	connect(contentsWidget,
 		SIGNAL(currentItemChanged(QListWidgetItem *, QListWidgetItem *)),
@@ -65,12 +59,26 @@
 	setWindowTitle(tr(&quot;Config Dialog&quot;));
 }
 
+ConfigDialog::~ConfigDialog()
+{
+	contentsWidget-&gt;clear();
+
+	// objects are not deleted by the GUI, but the plugins
+	// without this code, glibc will complain about deleting the same 
+	// object twise: the dangling pointer problem
+	for( int i=pagesWidget-&gt;count(); i!=0; i--)
+		pagesWidget-&gt;removeWidget( pagesWidget-&gt;currentWidget() );
+}
+
 void ConfigDialog::changePage(QListWidgetItem *current, QListWidgetItem *previous)
 {
 	if (!current)
         	current = previous;
 
-	pagesWidget-&gt;setCurrentIndex(contentsWidget-&gt;row(current));
+	int newRow = contentsWidget-&gt;row(current);
+	pagesWidget-&gt;setCurrentIndex( newRow );
+// 	QListWidgetItem *w = contentsWidget-&gt;item(newRow);
+// 	currentPageLabel-&gt;setText( w-&gt;text() );
 }
 
 void ConfigDialog::addPage( QWidget *w, QIcon i )
@@ -81,7 +89,23 @@
 	item-&gt;setTextAlignment( Qt::AlignHCenter );
 	item-&gt;setFlags( Qt::ItemIsSelectable | Qt::ItemIsEnabled );
 	
-	contentsWidget-&gt;insertItem( 0, item );
+	// QListWidget
+	contentsWidget-&gt;insertItem( contentsWidget-&gt;count(), item );
 
+	//QStackedWidget
 	pagesWidget-&gt;addWidget( w );
 }
+
+void ConfigDialog::removePage( QWidget *w )
+{
+	int k = pagesWidget-&gt;indexOf ( w );
+	contentsWidget-&gt;takeItem( k );
+	
+	//QStackedWidget 
+	pagesWidget-&gt;removeWidget( w );
+}
+
+
+void ConfigDialog::applyChanges()
+{
+}

Modified: tools/qmdilib/demos/plugin-demo/configdialog.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/configdialog.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/configdialog.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,26 +1,3 @@
-/****************************************************************************
-**
-** Copyright (C) 2005-2006 Trolltech AS. All rights reserved.
-**
-** This file is part of the example classes of the Qt Toolkit.
-**
-** This file may be used under the terms of the GNU General Public
-** License version 2.0 as published by the Free Software Foundation
-** and appearing in the file LICENSE.GPL included in the packaging of
-** this file.  Please review the following information to ensure GNU
-** General Public Licensing requirements will be met:
-** <A HREF="http://www.trolltech.com/products/qt/opensource.html">http://www.trolltech.com/products/qt/opensource.html</A>
-**
-** If you are unsure which license is appropriate for your use, please
-** review the following information:
-** <A HREF="http://www.trolltech.com/products/qt/licensing.html">http://www.trolltech.com/products/qt/licensing.html</A> or contact the
-** sales department at <A HREF="https://lists.berlios.de/mailman/listinfo/devqt-devel">sales at trolltech.com.</A>
-**
-** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE
-** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
-**
-****************************************************************************/
-
 #ifndef CONFIGDIALOG_H
 #define CONFIGDIALOG_H
 
@@ -28,6 +5,7 @@
 #include &lt;QIcon&gt;
 
 class QIcon;
+class QLabel;
 class QListWidget;
 class QListWidgetItem;
 class QStackedWidget;
@@ -36,16 +14,24 @@
 {
 	Q_OBJECT
 
+	friend class PluginManager;
+
 public:
 	ConfigDialog();
+	~ConfigDialog();
 
 public slots:
 	void changePage(QListWidgetItem *current, QListWidgetItem *previous);
 	void addPage( QWidget *w, QIcon i );
+	void removePage( QWidget *w );
+	void applyChanges();
 
 private:
-	QListWidget *contentsWidget;
-	QStackedWidget *pagesWidget;
+	QListWidget	*contentsWidget;
+	QStackedWidget	*pagesWidget;
+	QPushButton	*applyButton;
+	QPushButton	*closeButton;
+// 	QLabel		*currentPageLabel;
 };
 
 #endif

Modified: tools/qmdilib/demos/plugin-demo/iplugin.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/iplugin.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/iplugin.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -57,6 +57,11 @@
 	return enabled;
 }
 
+QIcon	IPlugin::getIcon()
+{
+	return QIcon(&quot;images/config.png&quot;);
+}
+
 QString	IPlugin::getName()
 {
 	return name;

Modified: tools/qmdilib/demos/plugin-demo/iplugin.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/iplugin.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/iplugin.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -29,6 +29,7 @@
 	virtual void SaveConfig( QSettings &amp;settings );
 
 	bool 	isEnabled();
+	QIcon	getIcon();
 	QString	getName();
 	QString getAuthor();
 	QString getsVersion();
@@ -44,4 +45,5 @@
 	bool autoEnabled;
 	bool enabled;
 };
+
 #endif // __IPLUGIN_H__

Modified: tools/qmdilib/demos/plugin-demo/mainwindow3.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/mainwindow3.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/mainwindow3.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -26,14 +26,15 @@
 void MainWindow3::initGUI()
 {
 	tabWidget = new qmdiTabWidget(this);
-	setCentralWidget( tabWidget );
 	
 	QToolButton *tabCloseBtn = new QToolButton(tabWidget);
 	tabCloseBtn-&gt;setAutoRaise( true );
-// 	connect( tabCloseBtn, SIGNAL(clicked()), this, SLOT(fileClose()));
+	connect( tabCloseBtn, SIGNAL(clicked()), this, SLOT(closeClient()));
 	tabCloseBtn-&gt;setIcon(QIcon(&quot;:images/closetab.png&quot;));
+	tabWidget-&gt;setCornerWidget( tabCloseBtn, Qt::TopRightCorner  );
+	setCentralWidget( tabWidget );
 
-	actionConfig = new QAction( &quot;config&quot;, this );
+	actionConfig = new QAction( &quot;&amp;Config&quot;, this );
 
 	menus[tr(&quot;&amp;File&quot;)];
 	menus[tr(&quot;&amp;Edit&quot;)];
@@ -52,3 +53,13 @@
 	connect( actionConfig, SIGNAL(triggered()), pluginManager, SLOT(configurePlugins()));
 	statusBar()-&gt;showMessage(&quot;Welcome - feel free to configure the GUI to your needs&quot;,5000);
 }
+
+void MainWindow3::closeClient()
+{
+	qmdiClient *client = dynamic_cast&lt;qmdiClient*&gt;( tabWidget-&gt;currentWidget());
+
+	if (client == NULL)
+		tabWidget-&gt;currentWidget()-&gt;deleteLater();
+
+	client-&gt;closeClient();
+}

Modified: tools/qmdilib/demos/plugin-demo/mainwindow3.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/mainwindow3.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/mainwindow3.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -17,6 +17,7 @@
 
 public slots:
 	void initGUI();
+	void closeClient();
 	
 private:
 	QTabWidget	*tabWidget;

Modified: tools/qmdilib/demos/plugin-demo/plugin-demo.pro
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugin-demo.pro	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugin-demo.pro	2006-05-05 12:19:05 UTC (rev 79)
@@ -20,8 +20,8 @@
 
 RESOURCES += ../mdi-tab/mdi-tab.qrc
 
-MOC_DIR = ../../tmp 
-UI_DIR = ../../tmp 
+MOC_DIR = .tmp 
+UI_DIR = .tmp 
 OBJECTS_DIR = .tmp 
 CONFIG += debug \
           warn_on 

Modified: tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/editor/editor.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,5 +1,7 @@
 #include &lt;QAction&gt;
 #include &lt;QMessageBox&gt;
+#include &lt;QFileDialog&gt;
+#include &lt;QMainWindow&gt;
 
 #include &quot;iplugin.h&quot;
 #include &quot;qmdiserver.h&quot;
@@ -10,7 +12,7 @@
 EditorPlugin::EditorPlugin()
 {
 	actionNew	= new_action( QIcon(&quot;:images/filenew.png&quot;), tr(&quot;&amp;New&quot;), this, tr(&quot;Ctrl+N&quot;), tr(&quot;Create a new file&quot;), SLOT(fileNew()) );
-	actionOpen	= new_action( QIcon(&quot;:images/filenew.png&quot;), tr(&quot;&amp;Open&quot;), this, tr(&quot;Ctrl+O&quot;), tr(&quot;Load a file&quot;), SLOT(fileOpen()) );
+	actionOpen	= new_action( QIcon(&quot;:images/fileopen.png&quot;), tr(&quot;&amp;Open&quot;), this, tr(&quot;Ctrl+O&quot;), tr(&quot;Load a file&quot;), SLOT(fileOpen()) );
 
 	name = tr(&quot;Text editor plugin&quot;);
 	author = tr(&quot;Diego Iastrubni &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/devqt-devel">elcuco at kde.org</A>&gt;&quot;);
@@ -21,6 +23,18 @@
 
 	menus[&quot;&amp;File&quot;]-&gt;addAction( actionNew );
 	menus[&quot;&amp;File&quot;]-&gt;addAction( actionOpen );
+
+// 	toolbars[&quot;File&quot;]-&gt;addAction( actionNew );
+// 	toolbars[&quot;File&quot;]-&gt;addAction( actionOpen );
+	
+	configUI = new QWidget;
+	ui.setupUi( configUI );
+
+	makeBackups	= false;
+	showLineNumbers	= true;
+	makeCurrentLine	= true;
+	wordWrap	= true;
+	setData();
 }
 
 EditorPlugin::~EditorPlugin()
@@ -34,6 +48,30 @@
 	QMessageBox::about( NULL, tr(&quot;Text Editor plugin&quot;), tr(&quot;This plugin brings text editing capabilities to the application&quot;) );
 }
 
+QWidget* EditorPlugin::getConfigDialog()
+{
+	return configUI;
+}
+
+void EditorPlugin::getData()
+{
+	makeBackups	= ui.cbMakeBackup-&gt;isChecked();
+	showLineNumbers	= ui.cbShowLineNumbers-&gt;isChecked();
+	makeCurrentLine	= ui.cbMarkCurrentLine-&gt;isChecked();
+	wordWrap	= ui.cbWorkWrap-&gt;isChecked();
+}
+
+void EditorPlugin::setData()
+{
+	ui.cbMakeBackup-&gt;setChecked( makeBackups );
+	ui.cbShowLineNumbers-&gt;setChecked( showLineNumbers );
+	ui.cbMarkCurrentLine-&gt;setChecked(makeCurrentLine);
+	ui.cbWorkWrap-&gt;setChecked(wordWrap);
+
+	// emit a signal and notify all editors
+	// about the new settings
+}
+
 void EditorPlugin::fileNew()
 {
 	if (!mdiServer)
@@ -44,11 +82,34 @@
 
 	QexTextEdit *editor = new QexTextEdit;
 	editor-&gt;hide();
-	editor-&gt;name = &quot;No name&quot;;
+	editor-&gt;name = tr(&quot;No name&quot;);
 	editor-&gt;setObjectName( editor-&gt;name );
 	mdiServer-&gt;addClient( editor );
 }
 
 void EditorPlugin::fileOpen()
 {
+	if (!mdiServer)
+	{
+		qDebug(&quot;%s - warning no mdiServer defined&quot;, __FUNCTION__ );
+		return;
+	}
+
+	QString s = QFileDialog::getOpenFileName(
+		NULL,
+	tr(&quot;Choose a file&quot;),
+		&quot;&quot;,
+		tr(&quot;Sources&quot;	,&quot;EditorPlugin::fileOpen: open source files&quot;)	+ &quot; (*.c *.cpp *.cxx *.h *.hpp *.hxx *.inc);;&quot; +
+		tr(&quot;Headers&quot;,	 &quot;EditorPlugin::fileOpen: open header files&quot;)	+ &quot; (*.h *.hpp *.hxx *.inc);;&quot;+
+		tr(&quot;Qt project&quot;, &quot;EditorPlugin::fileOpen: open *.pro&quot;)		+ &quot; (*.pro *.pri);;&quot;+
+		tr(&quot;All files&quot;,  &quot;EditorPlugin::fileOpen: open any file&quot;)	+ &quot; (*.*)&quot;
+	);
+
+	if (s.isEmpty())
+		return;
+
+	
+	QexTextEdit *editor = new QexTextEdit( s, dynamic_cast&lt;QMainWindow*&gt;(mdiServer) );
+	editor-&gt;hide();
+	mdiServer-&gt;addClient( editor );
 }

Modified: tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/editor/editor.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -2,6 +2,7 @@
 #define __EDITOR_PLUGIN_H__
 
 #include &quot;iplugin.h&quot;
+#include &quot;ui_editor_cfg.h&quot;
 
 class QAction;
 
@@ -13,14 +14,26 @@
 	~EditorPlugin();
 
 	void showAbout();
+	QWidget* getConfigDialog();
+	void getData();
+	void setData();
 
 public slots:
 	void fileNew();
 	void fileOpen();
 	
 private:
-	QAction *actionNew;
-	QAction *actionOpen;
+	QAction		*actionNew;
+	QAction		*actionOpen;
+	Ui::EditorCfgUI	ui;
+	QWidget		*configUI;
+
+	bool	makeBackups;
+	bool	showLineNumbers;
+	bool	makeCurrentLine;
+	bool	wordWrap;
+	QFont	editorFont;
+	int	endOfLine;
 };
 
 #endif// __EDITOR_PLUGIN_H__

Modified: tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/editor/editor_cfg.ui	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,5 +1,5 @@
 &lt;ui version=&quot;4.0&quot; &gt;
- &lt;author&gt;&lt;/author&gt;
+ &lt;author&gt;Diego Iastrubni &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/devqt-devel">elcuco at kde.org</A>&gt;&lt;/author&gt;
  &lt;comment&gt;&lt;/comment&gt;
  &lt;exportmacro&gt;&lt;/exportmacro&gt;
  &lt;class&gt;EditorCfgUI&lt;/class&gt;
@@ -8,8 +8,8 @@
    &lt;rect&gt;
     &lt;x&gt;0&lt;/x&gt;
     &lt;y&gt;0&lt;/y&gt;
-    &lt;width&gt;287&lt;/width&gt;
-    &lt;height&gt;245&lt;/height&gt;
+    &lt;width&gt;317&lt;/width&gt;
+    &lt;height&gt;325&lt;/height&gt;
    &lt;/rect&gt;
   &lt;/property&gt;
   &lt;property name=&quot;windowTitle&quot; &gt;
@@ -51,28 +51,28 @@
            &lt;number&gt;6&lt;/number&gt;
           &lt;/property&gt;
           &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox&quot; &gt;
+           &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbMakeBackup&quot; &gt;
             &lt;property name=&quot;text&quot; &gt;
              &lt;string&gt;Make backups&lt;/string&gt;
             &lt;/property&gt;
            &lt;/widget&gt;
           &lt;/item&gt;
           &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox_2&quot; &gt;
+           &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbShowLineNumbers&quot; &gt;
             &lt;property name=&quot;text&quot; &gt;
              &lt;string&gt;Show line numbers&lt;/string&gt;
             &lt;/property&gt;
            &lt;/widget&gt;
           &lt;/item&gt;
           &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox_3&quot; &gt;
+           &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbMarkCurrentLine&quot; &gt;
             &lt;property name=&quot;text&quot; &gt;
              &lt;string&gt;Mark current line&lt;/string&gt;
             &lt;/property&gt;
            &lt;/widget&gt;
           &lt;/item&gt;
           &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox_4&quot; &gt;
+           &lt;widget class=&quot;QCheckBox&quot; name=&quot;cbWorkWrap&quot; &gt;
             &lt;property name=&quot;text&quot; &gt;
              &lt;string&gt;Word wrap&lt;/string&gt;
             &lt;/property&gt;
@@ -90,7 +90,7 @@
           &lt;number&gt;6&lt;/number&gt;
          &lt;/property&gt;
          &lt;item&gt;
-          &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButton&quot; &gt;
+          &lt;widget class=&quot;QToolButton&quot; name=&quot;btnChooseFont&quot; &gt;
            &lt;property name=&quot;text&quot; &gt;
             &lt;string&gt;...&lt;/string&gt;
            &lt;/property&gt;
@@ -131,7 +131,7 @@
           &lt;/widget&gt;
          &lt;/item&gt;
          &lt;item&gt;
-          &lt;widget class=&quot;QComboBox&quot; name=&quot;comboBox&quot; &gt;
+          &lt;widget class=&quot;QComboBox&quot; name=&quot;comboEOL&quot; &gt;
            &lt;item&gt;
             &lt;property name=&quot;text&quot; &gt;
              &lt;string&gt;Don't modify&lt;/string&gt;
@@ -167,6 +167,7 @@
    &lt;/item&gt;
   &lt;/layout&gt;
  &lt;/widget&gt;
+ &lt;layoutdefault spacing=&quot;0&quot; margin=&quot;0&quot; /&gt;
  &lt;pixmapfunction&gt;&lt;/pixmapfunction&gt;
  &lt;resources/&gt;
  &lt;connections/&gt;

Modified: tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/help/help.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -1,8 +1,11 @@
 #include &lt;QAction&gt;
+#include &lt;QProcess&gt;
 #include &lt;QApplication&gt;
 #include &lt;QUrl&gt;
 #include &lt;QLibraryInfo&gt;
 #include &lt;QMessageBox&gt;
+#include &lt;QMainWindow&gt;
+#include &lt;QStatusBar&gt;
 
 #include &quot;iplugin.h&quot;
 #include &quot;qmdiserver.h&quot;
@@ -15,8 +18,10 @@
 {
 	actionAbout	= new_action( QIcon(), tr(&quot;&amp;About&quot;), this, &quot;&quot;, tr(&quot;XXXXX&quot;), SLOT(showAboutApp()) );
 	actionAboutQt	= new_action( QIcon(), tr(&quot;&amp;About Qt&quot;), this, &quot;&quot;, tr(&quot;XXXXX&quot;), SLOT(showAboutQt()) );
- 	actionShowQtHelp= new_action( QIcon(), tr(&quot;&amp;Qt help&quot;), this, &quot;&quot;, tr(&quot;XXXXX&quot;), SLOT(showQtHelp()) );
+	actionShowQtHelp= new_action( QIcon(), tr(&quot;&amp;Qt help&quot;), this, &quot;F1&quot;, tr(&quot;XXXXX&quot;), SLOT(showQtHelp()) );
 
+// 	actionAbout-&gt;setShortcut( &quot;F1&quot; );
+
 	name = &quot;Help plugin&quot;;
 	author = &quot;Diego Iastrubni &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/devqt-devel">elcuco at kde.org</A>&gt;&quot;;
 	iVersion = 0;
@@ -28,6 +33,8 @@
 	menus[&quot;&amp;Help&quot;]-&gt;addSeparator();
 	menus[&quot;&amp;Help&quot;]-&gt;addAction( actionAbout );
 	menus[&quot;&amp;Help&quot;]-&gt;addAction( actionAboutQt );
+
+// 	externalBrowser = &quot;/opt/kde3/bin/konqueror&quot;;
 }
 
 HelpPlugin::~HelpPlugin()
@@ -54,9 +61,32 @@
 void HelpPlugin::showQtHelp()
 {
 	QString helpFile = QLibraryInfo::location(QLibraryInfo::DocumentationPath) + QLatin1String(&quot;/html/index.html&quot;);
+	
 	QexHelpBrowser *browser = new QexHelpBrowser( QUrl(helpFile) );
 	browser-&gt;hide();
 	browser-&gt;name = &quot;Qt help&quot;;
 	browser-&gt;setObjectName( browser-&gt;name );
+	connect( browser, SIGNAL(sourceChanged(QUrl)), this, SLOT(on_browser_sourceChanged(QUrl)));
+	
 	mdiServer-&gt;addClient( browser );
 }
+
+void HelpPlugin::on_browser_sourceChanged ( const QUrl &amp; src )
+{
+	if (externalBrowser.isEmpty())
+		return;
+
+	if ((src.scheme() == &quot;file&quot;) || (src.scheme().isEmpty()))
+		    return;
+	
+	if (!QProcess::startDetached( externalBrowser, QStringList(src.toString()) ))
+	{
+		QWidget *w = dynamic_cast&lt;QWidget*&gt;(mdiServer);
+		if (w == NULL)
+			return;
+			
+		QMainWindow *ww = dynamic_cast&lt;QMainWindow*&gt;(w-&gt;window());
+		if (ww)
+			ww-&gt;statusBar()-&gt;showMessage(&quot;Error: could not start external browser&quot;, 5000);
+	}
+}

Modified: tools/qmdilib/demos/plugin-demo/plugins/help/help.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/help/help.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/help/help.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -4,6 +4,7 @@
 #include &quot;iplugin.h&quot;
 
 class QAction;
+class QUrl;
 
 class HelpPlugin: public IPlugin
 {
@@ -17,11 +18,15 @@
 	void showAboutApp();
 	void showAboutQt();
 	void showQtHelp();
+
+	void on_browser_sourceChanged ( const QUrl &amp; src );
 	
 private:
 	QAction *actionAbout;
 	QAction *actionAboutQt;
 	QAction *actionShowQtHelp;
+
+	QString externalBrowser;
 };
 
 #endif// __HELP_PLUGIN_H__

Modified: tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui
===================================================================
--- tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/plugins/help/help_cfg.ui	2006-05-05 12:19:05 UTC (rev 79)
@@ -8,8 +8,8 @@
    &lt;rect&gt;
     &lt;x&gt;0&lt;/x&gt;
     &lt;y&gt;0&lt;/y&gt;
-    &lt;width&gt;287&lt;/width&gt;
-    &lt;height&gt;245&lt;/height&gt;
+    &lt;width&gt;418&lt;/width&gt;
+    &lt;height&gt;285&lt;/height&gt;
    &lt;/rect&gt;
   &lt;/property&gt;
   &lt;property name=&quot;windowTitle&quot; &gt;
@@ -23,148 +23,108 @@
     &lt;number&gt;6&lt;/number&gt;
    &lt;/property&gt;
    &lt;item&gt;
-    &lt;widget class=&quot;QTabWidget&quot; name=&quot;tabWidget&quot; &gt;
-     &lt;property name=&quot;currentIndex&quot; &gt;
+    &lt;widget class=&quot;QLabel&quot; name=&quot;label_3&quot; &gt;
+     &lt;property name=&quot;text&quot; &gt;
+      &lt;string&gt;&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;qrichtext&quot; content=&quot;1&quot; /&gt;&lt;/head&gt;&lt;body style=&quot; white-space: pre-wrap; font-family:FreeSans; font-size:10pt; font-weight:400; font-style:normal; text-decoration:none;&quot;&gt;&lt;p style=&quot; margin-top:18px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-weight:600;&quot;&gt;&lt;font size=&quot;6&quot;&gt;&lt;font size=&quot;6&quot;&gt;Help Browser Configuration&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;&quot;&gt; The internal browser cannot handle external links, or PDF files. When you click some links, their content will be displayed with these applications.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;textFormat&quot; &gt;
+      &lt;enum&gt;Qt::RichText&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;scaledContents&quot; &gt;
+      &lt;bool&gt;true&lt;/bool&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;wordWrap&quot; &gt;
+      &lt;bool&gt;true&lt;/bool&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item&gt;
+    &lt;widget class=&quot;Line&quot; name=&quot;line&quot; &gt;
+     &lt;property name=&quot;orientation&quot; &gt;
+      &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item&gt;
+    &lt;layout class=&quot;QHBoxLayout&quot; &gt;
+     &lt;property name=&quot;margin&quot; &gt;
       &lt;number&gt;0&lt;/number&gt;
      &lt;/property&gt;
-     &lt;widget class=&quot;QWidget&quot; name=&quot;tab&quot; &gt;
-      &lt;attribute name=&quot;title&quot; &gt;
-       &lt;string&gt;General&lt;/string&gt;
-      &lt;/attribute&gt;
-      &lt;layout class=&quot;QVBoxLayout&quot; &gt;
-       &lt;property name=&quot;margin&quot; &gt;
-        &lt;number&gt;9&lt;/number&gt;
+     &lt;property name=&quot;spacing&quot; &gt;
+      &lt;number&gt;6&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label_2&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;External browser&lt;/string&gt;
        &lt;/property&gt;
-       &lt;property name=&quot;spacing&quot; &gt;
-        &lt;number&gt;6&lt;/number&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;spacer&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
        &lt;/property&gt;
-       &lt;item&gt;
-        &lt;widget class=&quot;QGroupBox&quot; name=&quot;groupBox&quot; &gt;
-         &lt;property name=&quot;title&quot; &gt;
-          &lt;string&gt;GroupBox&lt;/string&gt;
-         &lt;/property&gt;
-         &lt;layout class=&quot;QVBoxLayout&quot; &gt;
-          &lt;property name=&quot;margin&quot; &gt;
-           &lt;number&gt;9&lt;/number&gt;
-          &lt;/property&gt;
-          &lt;property name=&quot;spacing&quot; &gt;
-           &lt;number&gt;6&lt;/number&gt;
-          &lt;/property&gt;
-          &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox&quot; &gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;Make backups&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/widget&gt;
-          &lt;/item&gt;
-          &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox_2&quot; &gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;Show line numbers&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/widget&gt;
-          &lt;/item&gt;
-          &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox_3&quot; &gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;Mark current line&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/widget&gt;
-          &lt;/item&gt;
-          &lt;item&gt;
-           &lt;widget class=&quot;QCheckBox&quot; name=&quot;checkBox_4&quot; &gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;Word wrap&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/widget&gt;
-          &lt;/item&gt;
-         &lt;/layout&gt;
-        &lt;/widget&gt;
-       &lt;/item&gt;
-       &lt;item&gt;
-        &lt;layout class=&quot;QHBoxLayout&quot; &gt;
-         &lt;property name=&quot;margin&quot; &gt;
-          &lt;number&gt;0&lt;/number&gt;
-         &lt;/property&gt;
-         &lt;property name=&quot;spacing&quot; &gt;
-          &lt;number&gt;6&lt;/number&gt;
-         &lt;/property&gt;
-         &lt;item&gt;
-          &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButton&quot; &gt;
-           &lt;property name=&quot;text&quot; &gt;
-            &lt;string&gt;...&lt;/string&gt;
-           &lt;/property&gt;
-          &lt;/widget&gt;
-         &lt;/item&gt;
-         &lt;item&gt;
-          &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot; &gt;
-           &lt;property name=&quot;text&quot; &gt;
-            &lt;string&gt;Editor font&lt;/string&gt;
-           &lt;/property&gt;
-          &lt;/widget&gt;
-         &lt;/item&gt;
-         &lt;item&gt;
-          &lt;widget class=&quot;QLineEdit&quot; name=&quot;lineEdit&quot; &gt;
-           &lt;property name=&quot;enabled&quot; &gt;
-            &lt;bool&gt;false&lt;/bool&gt;
-           &lt;/property&gt;
-           &lt;property name=&quot;readOnly&quot; &gt;
-            &lt;bool&gt;true&lt;/bool&gt;
-           &lt;/property&gt;
-          &lt;/widget&gt;
-         &lt;/item&gt;
-        &lt;/layout&gt;
-       &lt;/item&gt;
-       &lt;item&gt;
-        &lt;layout class=&quot;QHBoxLayout&quot; &gt;
-         &lt;property name=&quot;margin&quot; &gt;
-          &lt;number&gt;0&lt;/number&gt;
-         &lt;/property&gt;
-         &lt;property name=&quot;spacing&quot; &gt;
-          &lt;number&gt;6&lt;/number&gt;
-         &lt;/property&gt;
-         &lt;item&gt;
-          &lt;widget class=&quot;QLabel&quot; name=&quot;label_2&quot; &gt;
-           &lt;property name=&quot;text&quot; &gt;
-            &lt;string&gt;End of line&lt;/string&gt;
-           &lt;/property&gt;
-          &lt;/widget&gt;
-         &lt;/item&gt;
-         &lt;item&gt;
-          &lt;widget class=&quot;QComboBox&quot; name=&quot;comboBox&quot; &gt;
-           &lt;item&gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;Don't modify&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/item&gt;
-           &lt;item&gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;Unix (CR)&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/item&gt;
-           &lt;item&gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;DOS/Window (CR/LF)&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/item&gt;
-           &lt;item&gt;
-            &lt;property name=&quot;text&quot; &gt;
-             &lt;string&gt;Mac (LF)&lt;/string&gt;
-            &lt;/property&gt;
-           &lt;/item&gt;
-          &lt;/widget&gt;
-         &lt;/item&gt;
-        &lt;/layout&gt;
-       &lt;/item&gt;
-      &lt;/layout&gt;
-     &lt;/widget&gt;
-     &lt;widget class=&quot;QWidget&quot; name=&quot;tab_2&quot; &gt;
-      &lt;attribute name=&quot;title&quot; &gt;
-       &lt;string&gt;Tab 2&lt;/string&gt;
-      &lt;/attribute&gt;
-     &lt;/widget&gt;
-    &lt;/widget&gt;
+       &lt;property name=&quot;sizeHint&quot; &gt;
+        &lt;size&gt;
+         &lt;width&gt;137&lt;/width&gt;
+         &lt;height&gt;20&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+      &lt;/spacer&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QLineEdit&quot; name=&quot;lineEdit&quot; /&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButton&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;...&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
    &lt;/item&gt;
+   &lt;item&gt;
+    &lt;layout class=&quot;QHBoxLayout&quot; &gt;
+     &lt;property name=&quot;margin&quot; &gt;
+      &lt;number&gt;0&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;spacing&quot; &gt;
+      &lt;number&gt;6&lt;/number&gt;
+     &lt;/property&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;PDF viewer&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;spacer&gt;
+       &lt;property name=&quot;orientation&quot; &gt;
+        &lt;enum&gt;Qt::Horizontal&lt;/enum&gt;
+       &lt;/property&gt;
+       &lt;property name=&quot;sizeHint&quot; &gt;
+        &lt;size&gt;
+         &lt;width&gt;143&lt;/width&gt;
+         &lt;height&gt;20&lt;/height&gt;
+        &lt;/size&gt;
+       &lt;/property&gt;
+      &lt;/spacer&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QLineEdit&quot; name=&quot;lineEdit_2&quot; /&gt;
+     &lt;/item&gt;
+     &lt;item&gt;
+      &lt;widget class=&quot;QToolButton&quot; name=&quot;toolButton_2&quot; &gt;
+       &lt;property name=&quot;text&quot; &gt;
+        &lt;string&gt;...&lt;/string&gt;
+       &lt;/property&gt;
+      &lt;/widget&gt;
+     &lt;/item&gt;
+    &lt;/layout&gt;
+   &lt;/item&gt;
   &lt;/layout&gt;
  &lt;/widget&gt;
  &lt;pixmapfunction&gt;&lt;/pixmapfunction&gt;

Modified: tools/qmdilib/demos/plugin-demo/pluningmanager.cpp
===================================================================
--- tools/qmdilib/demos/plugin-demo/pluningmanager.cpp	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/pluningmanager.cpp	2006-05-05 12:19:05 UTC (rev 79)
@@ -20,7 +20,7 @@
 
 /**
  * \brief A class which manages a list of plugins and merges their menus and toolbars to the main application
- * \author Diego Iastrubni &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/devqt-devel">elcuco at kde.org</A>&gt;
+ * \author Diego Iastrubni (<A HREF="https://lists.berlios.de/mailman/listinfo/devqt-devel">elcuco at kde.org</A>)
  * 
  */
 PluginManager::PluginManager( qmdiHost *host, qmdiServer *server )
@@ -31,17 +31,28 @@
 	QWidget *w = new QWidget;
 	ui.setupUi( w );
 	w-&gt;setObjectName(&quot;config&quot;);
-	
+
+	connect( dlg.applyButton, SIGNAL(clicked()), this, SLOT(on_apply_dialog()));
+	connect( dlg.closeButton, SIGNAL(clicked()), this, SLOT(on_close_dialog()));
+
+	// define the main configuration panel
 	pluginModel = new PluginModel( &amp;plugins );
 	ui.listWidget-&gt;setModel( pluginModel );
 	connect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 	connect( ui.btnAbout, SIGNAL(clicked()), this, SLOT(on_aboutPlugin_clicked()));
-	
 	connect( ui.listWidget, SIGNAL(activated(QModelIndex)), this, SLOT(on_listWidget_activated(QModelIndex)));
 	connect( ui.listWidget, SIGNAL(entered(QModelIndex)), this, SLOT(on_listWidget_activated(QModelIndex)));
 	connect( ui.listWidget, SIGNAL(clicked(QModelIndex)), this, SLOT(on_listWidget_activated(QModelIndex)));
 
 	dlg.addPage( w, QIcon(&quot;images/config.png&quot;) );
+
+	/*
+	mainOpen = new QAction( &quot;New Multi Open&quot;, this );
+	menus[&quot;&amp;File&quot;]-&gt;addAction( mainOpen );
+	connect( mainOpen, SIGNAL(triggered()), this, SLOT(on_mainOpen_clicked()));
+	if (mdiHost)
+		mdiHost-&gt;mergeClient( this );
+	*/
 }
 
 PluginManager::~PluginManager()
@@ -63,6 +74,11 @@
 	if (!newplugin)
 		return;
 
+	// when the checkboxes state is modified, a signal is been emited
+	// we need to ignore this for this function. re-connected at the end of this
+	// function
+	disconnect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
+	
 	QModelIndex parent = pluginModel-&gt;index(0, 0, parent);
 	int count = pluginModel-&gt;columnCount();
 	
@@ -79,6 +95,9 @@
 	{
 		newplugin-&gt;enabled = true;
 		mdiHost-&gt;mergeClient( newplugin );
+	
+		if (newplugin-&gt;getConfigDialog() != NULL)
+			dlg.addPage( newplugin-&gt;getConfigDialog(), newplugin-&gt;getIcon() );
 	}
 
 
@@ -98,6 +117,8 @@
 // 		TODO why does this crash?
 // 		ui.cbEnabled-&gt;setChecked( newplugin-&gt;isEnabled() );
 	}
+
+	connect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 }
 
 // called when the user seleccts a new plugin
@@ -108,6 +129,10 @@
 	if (!plugin)
 		return;
 
+	// when the checkboxes state is modified, a signal is been emited
+	// we need to ignore this for this function. re-connected at the end of this
+	// function
+	disconnect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 	ui.pluginName-&gt;setText( plugin-&gt;getName() );
 	ui.pluginName-&gt;setCursorPosition( 0 );
 	
@@ -119,6 +144,7 @@
 
 	ui.cbEnabled-&gt;setEnabled( !plugin-&gt;alwaysEnabled );
 	ui.cbEnabled-&gt;setChecked( plugin-&gt;isEnabled() );
+	connect( ui.cbEnabled, SIGNAL(toggled(bool)), this, SLOT(on_cbEnabled_togglged(bool)));
 }
 
 // called when the user checks on unchecks to enable a plugin
@@ -132,15 +158,21 @@
 
 	plugin-&gt;enabled = checked;
 	if (checked)
-	{		
-		// TODO add also the configuration dialog for this plugin
+	{
+		if (plugin-&gt;getConfigDialog() != NULL)
+			dlg.addPage( plugin-&gt;getConfigDialog(), plugin-&gt;getIcon() );
+
+		plugin-&gt;setData();
 		mdiHost-&gt;mergeClient( plugin );
 	}
 	else
 	{
-		// TODO remove also the configuration dialog for this plugin
+		if (plugin-&gt;getConfigDialog() != NULL)
+			dlg.removePage( plugin-&gt;getConfigDialog() );
+		
 		mdiHost-&gt;unmergeClient( plugin );
 	}
+	
 	mdiHost-&gt;updateGUI( dynamic_cast&lt;QMainWindow*&gt;(mdiHost) );
 }
 
@@ -157,6 +189,34 @@
 	
 	plugin-&gt;showAbout();
 
+	// TODO still now what i want, still the dialog has no focus after the
+	// about box of the plugin
 	dlg.raise();
 	dlg.setFocus();
 }
+
+void PluginManager::on_mainOpen_clicked()
+{
+	qDebug( &quot;ping&quot; );
+}
+
+void PluginManager::on_apply_dialog()
+{
+	IPlugin	*p;
+	foreach( p, plugins )
+	{
+		if (p-&gt;enabled)
+			p-&gt;getData();
+	}
+}
+
+void PluginManager::on_close_dialog()
+{
+	IPlugin	*p;
+	foreach( p, plugins )
+	{
+		if (p-&gt;enabled)
+			p-&gt;setData();
+	}
+}
+

Modified: tools/qmdilib/demos/plugin-demo/pluningmanager.h
===================================================================
--- tools/qmdilib/demos/plugin-demo/pluningmanager.h	2006-04-28 22:57:55 UTC (rev 78)
+++ tools/qmdilib/demos/plugin-demo/pluningmanager.h	2006-05-05 12:19:05 UTC (rev 79)
@@ -13,6 +13,7 @@
 #define PLUNINGMANAGER_H
 
 #include &lt;QObject&gt;
+#include &quot;qmdiclient.h&quot;
 #include &quot;configdialog.h&quot;
 #include &quot;ui_plugin_list.h&quot;
 
@@ -23,7 +24,7 @@
 class PluginModel;
 class QStandardItemModel;
 
-class PluginManager: public QObject
+class PluginManager: public QObject, public qmdiClient
 {
 	Q_OBJECT
 	
@@ -37,7 +38,11 @@
 	void on_listWidget_activated(const QModelIndex &amp; index );
 	void on_cbEnabled_togglged( bool checked );
 	void on_aboutPlugin_clicked();
-	
+	void on_mainOpen_clicked();
+
+	void on_apply_dialog();
+	void on_close_dialog();
+
 private:
 	QList&lt;IPlugin*&gt;		plugins;
 	QStandardItemModel	*pluginModel;
@@ -45,6 +50,8 @@
 	qmdiServer		*mdiServer;
 	ConfigDialog		dlg;
 	Ui::plugin_list ui;
+
+// 	QAction			*mainOpen;
 };
 
 #endif


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000063.html">[Devqt-devel] RE : new branch alpha 3
</A></li>
	<LI>Next message: <A HREF="000065.html">[Devqt-devel] r80 - tools/qmdilib/demos/plugin-demo
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#64">[ date ]</a>
              <a href="thread.html#64">[ thread ]</a>
              <a href="subject.html#64">[ subject ]</a>
              <a href="author.html#64">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/devqt-devel">More information about the Devqt-devel
mailing list</a><br>
</body></html>
